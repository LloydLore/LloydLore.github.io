<!DOCTYPE html>
<html lang="en"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
<title>before-save-hook é»˜è®¤ä¸æ˜¯ buffer local variable</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=5, user-scalable=5" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">















  






      <script src="/js/toc.js"></script>
    
    <link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">

<link rel="stylesheet" href="/scss/dark-mode.min.c6421d712fbd79d98380b2e5a6d50a4dd11f7bdd990ecdcd2cd2825aec232535.css" integrity="sha256-xkIdcS&#43;9edmDgLLlptUKTdEfe92ZDs3NLNKCWuwjJTU=" media="screen">


<link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Material+Icons">



















</head>
<body>
    	<div id="app"><div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories/">
                    categories
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags/">
                    tags
                </a>
                
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts/">
                    posts
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#trial-1-after-save-hook" class="nav-trial-1-after-save-hook">
									Trial 1 - after-save-hook
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#trial-2-before-save-hook" class="nav-trial-2-before-save-hook">
									Trial 2 - before-save-hook
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#tiral-3-before-save-hook-localization" class="nav-tiral-3-before-save-hook-localization">
									Tiral 3 - before-save-hook localization
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%9b%b4%e5%a4%9a%e8%ae%be%e7%bd%ae" class="nav-æ›´å¤šè®¾ç½®">
									æ›´å¤šè®¾ç½®
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="http://localhost:1313/">
            A Byte of Cybersecurity
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="http://localhost:1313/">
        <div class="single-column-header-title">A Byte of Cybersecurity</div>
        
        <div class="single-column-header-subtitle">ğŸ’“ â˜®ï¸</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    before-save-hook é»˜è®¤ä¸æ˜¯ buffer local variable
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2024-01-15 00:00
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/emacs">Emacs</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/org">org</a>
                                &nbsp;
                            
                                <a href="/tags/emacs">emacs</a>
                                &nbsp;
                            
                                <a href="/tags/hugo">hugo</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <p>æˆ‘æœ€è¿‘å‡†å¤‡ç”¨ <a href="https://docutils.sourceforge.io/rst.html">reStructuredText</a> åšç»“æ„åŒ–æ–‡æ¡£çš„å¤„ç†ã€‚
åŸºäºæˆ‘å·²ç»æ˜¯ä¸€ä¸ªé‡åº¦çš„ <code>org-mode</code> æ‚£è€…ï¼Œæˆ‘åœ¨åšä»»ä½•ç¬”è®°çš„æ—¶å€™ï¼Œç¦»å¼€ <code>org-mode</code> ä¾¿æ˜¾å¾—å„ç§
ä¸é€‚åº”ã€‚è™½ç„¶èƒ½çœ‹åˆ° <a href="https://daringfireball.net/projects/markdown/">Markdown</a> å¾ˆæ¸…ç§€ï¼ŒreStructuredText å¾ˆ sexyï¼Œä½†æˆ‘å¤§æœ‰â€œé‡èŠ±ä¸å¦‚å®¶èŠ±é¦™â€çš„
æ„Ÿæ…¨ã€‚</p>
<p>æ¯å½“æˆ‘å¸å®Œå…¶ä»–çš„å·¥å…·ä¹‹åï¼Œæœ€åè¿˜æ˜¯ä¹–ä¹–å›åˆ°äº† <code>org-mode</code>. ä½†æˆ‘ä¸å¾—ä¸æ‰¿è®¤çš„æ˜¯ï¼Œ reStructuredText é…åˆ <a href="https://www.sphinx-doc.org/en/master/">Sphinx</a> æœ‰ä¸€ç§åŒ–ç¹ä¸ºç®€çš„ç¾æ„Ÿã€‚æˆ‘æ›¾ç»æœ‰è¿‡æƒ³ç”¨ <code>org-mode</code> åœ¨å¤§å‹
é¡¹ç›®é‡Œå®è·µ <a href="https://en.wikipedia.org/wiki/Literate_programming">Literate programming</a> çš„æƒ³æ³•ï¼Œä½†ä¸€æƒ³åˆ°è¦å¦‚ä½•æ¨å¹¿ <code>org-mode</code>,æ•´ä»¶äº‹æƒ…åˆ°é‚£å„¿å°±
æˆ›ç„¶è€Œæ­¢äº†ã€‚æ¯•ç«Ÿæ¨å¹¿ <code>org-mode</code> å’Œæ¨å¹¿ <code>GNU Emacs</code> ä¸€æ ·è‰°éš¾ï¼Œäººå„æœ‰å–œå¥½ï¼Œå„æœ‰æ¥å—ç¨‹åº¦ï¼Œ
<code>org-mode</code> å’Œ <code>GNU Emacs</code> æ›´åƒæ˜¯ç°ä»£æ­¦æ—çš„é‚ªæ´¾æ­¦åŠŸã€‚</p>
<p>è¨€å½’æ­£ä¼ ï¼Œæˆ‘ç”¨ <code>org-mode</code> è®°å½•äº†ä¸€ç¯‡ç¬”è®°ä¹‹åï¼Œä½¿ç”¨ <a href="https://github.com/msnoigrs/ox-rst">ox-rst</a> å¯¼å‡ºåˆ° rst æ ¼å¼ã€‚è¿™é‡Œé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼š
æˆ‘ä¸æƒ³æ¯æ¬¡ä¿å­˜å®Œ <code>org-mode</code> buffer ä¹‹åï¼Œåœ¨æ‰‹åŠ¨å»åšä¸€äº›å¯¼å‡ºï¼Œé‚£æ ·æ˜¾å¾—æˆ‘å¤ªè ¢äº†ï¼Œæ— æ³•ä½“ç°å‡º
<code>GNU Emacs</code> çš„é‚ªå…¸è‰ºæœ¯ã€‚æ‰€ä»¥åšä¸€ä¸ªè‡ªåŠ¨å¯¼å‡ºçš„è®¾ç½®å§ï¼Œ <strong>Let&rsquo;s trial and error!!!</strong></p>
<h2 id="trial-1-after-save-hook">Trial 1 - <code>after-save-hook</code></h2>
<p>æˆ‘å…ˆæƒ³åˆ°çš„æ˜¯ç”¨ <code>hook</code>, ä¸€é€š <code>C-h v</code> æ“ä½œä¸‹æ¥ï¼Œè¯•ä¸‹ <code>after-save-hook</code>,ä»£ç å¾ˆç®€å•ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(add-to-hook <span style="color:#e6db74">&#39;after-save-hook</span> <span style="color:#a6e22e">#&#39;</span>org-rst-export-to-rst)
</span></span></code></pre></div><div class="src-block-caption">
  <span class="src-block-number">Code Snippet 1:</span>
  example for bad setting with after-save-hook
</div>
<p>æˆ‘å¾ˆæ‚²å‰§çš„å‘ç°ï¼ŒåŠ äº†è¿™ä¸ª hook ä¹‹åï¼Œæˆ‘æ²¡æœ‰åŠæ³•ä¿å­˜æ–‡ä»¶ã€‚ä¼¼ä¹æ¯æ¬¡æ‰§è¡Œå¯¼å‡ºçš„æ“ä½œåï¼Œbuffer å°±å˜æˆ
ç¼–è¾‘è¿‡åçš„çŠ¶æ€ï¼Œæˆ‘ç¥å¥‡åœ°æäº†ä¸€ä¸ªæ­»å¾ªç¯ã€‚ä¸€ç›´ <code>save-export-save-export...</code>.</p>
<h2 id="trial-2-before-save-hook">Trial 2 - <code>before-save-hook</code></h2>
<p>æ—¢ç„¶ <code>save-buffer</code> ä¹‹åä¸è¡Œï¼Œé‚£ä¹ˆå°±åœ¨ä¿å­˜ä¹‹å‰å§ï¼Œæ¯•ç«Ÿè¿™æ ·å¾ˆåˆç†ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(add-hook <span style="color:#e6db74">&#39;before-save-hook</span> <span style="color:#a6e22e">#&#39;</span>org-rst-export-to-rst)
</span></span></code></pre></div><div class="src-block-caption">
  <span class="src-block-number">Code Snippet 2:</span>
  example for bad setting with before-save-hook
</div>
<p>OK, ä¿å­˜çš„é—®é¢˜è§£å†³äº†ã€‚ä½†æ‚²å‰§æ€»æ˜¯ä»ä¸€ç§å½¢å¼è½¬å˜æˆå¦å¤–ä¸€ç§å½¢å¼ï¼Œæˆ‘ä»¥ä¸º <code>before-save-hook</code> æ˜¯ <code>local variable</code>, ä½†ä»–ä¸æ˜¯çš„ã€‚æˆ‘ä¿å­˜çš„æ¯ä¸€ä¸ªæ–‡ä»¶ï¼Œéƒ½æ¥äº†ä¸€ä¸ª <code>.rst</code> åç¼€ï¼Œä½ èƒ½æƒ³è±¡ <code>foo-bar.rst.rst</code> çš„ç¾å—ï¼Ÿ</p>
<h2 id="tiral-3-before-save-hook-localization">Tiral 3 - <code>before-save-hook</code> localization</h2>
<p>é‚£â€¦â€¦ æœ‰æ²¡æœ‰ä¸€ç§åŠæ³•ï¼Œåˆ›é€ ä¸€ä¸ª <code>local variable</code> å‘¢ï¼Ÿ</p>
<p>æœ‰çš„ã€‚åœ¨<a href="https://stackoverflow.com/questions/1931784/emacs-is-before-save-hook-a-local-variable">è¿™é‡Œ</a>æˆ‘æ‰¾åˆ°äº†ç­”æ¡ˆã€‚è¿™ä¸ªç­”æ¡ˆå·²ç»åœ¨ä¸‡ç»´ç½‘ä¸­å­˜åœ¨äº† 14 å¹´ï¼Œåœ¨ä»Šå¤©ç»ˆäºè¢«æˆ‘æ•è·äº†ã€‚
è¿›è€Œæˆ‘çœ‹äº† <code>add-hook</code> çš„ manual, å®ƒçš„ signature æ˜¯è¿™æ ·çš„ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(add-hook HOOK FUNCTION <span style="color:#66d9ef">&amp;optional</span> DEPTH LOCAL)
</span></span></code></pre></div><div class="src-block-caption">
  <span class="src-block-number">Code Snippet 3:</span>
  example for good setting with before-save-hook
</div>
<p>å°±æ˜¯è¿™ä¸ª <code>LOCAL</code>, å°†å®ƒè®¾ç½®æˆ <code>t</code> ä¹‹åï¼Œä¼šåˆ›å»ºä¸€ä¸ª <code>before-save-hook</code> çš„åŒå <code>local variable</code>. è€Œè¿™ä¸ª hook çš„æ‰§è¡Œé¡ºåºï¼Œåˆ™æ˜¯å…ˆæŒ‰ç…§ <code>global variable</code> çš„å˜é‡æ‰§è¡Œä¸€æ¬¡ï¼Œ
åœ¨æ‰§è¡Œä¸€æ¬¡ <code>local variable</code>.</p>
<p>äºæ˜¯ä¹ï¼Œè¿™ä¸ªé—®é¢˜è§£å†³äº†ã€‚é¢ï¼Œä½ è¯´é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿé‚£å°±æ˜¯æˆ‘å¯ä»¥ä¿å­˜å®Œ <code>org-mode</code> çš„æ–‡ä»¶åï¼Œè‡ªåŠ¨å¾—åˆ°
<code>*.rst</code> çš„æ–‡ä»¶äº†ã€‚ <strong>Bravo!</strong></p>
<h2 id="æ›´å¤šè®¾ç½®">æ›´å¤šè®¾ç½®</h2>
<p>åœ¨è¿™é‡Œå…¶å®è¿˜æ¶‰åŠåˆ°æˆ‘å¯¹æŸä¸ª <code>org-mode buffer</code> åšçš„ <code>local variable</code> çš„è®¾ç½®ï¼Œä¸¾ä¸ªä¾‹å­å§ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>=# Local Variables:=
</span></span><span style="display:flex;"><span>=# eval: (add-hook &#39;before-save-hook #&#39;org-rst-export-to-rst nil t)=
</span></span><span style="display:flex;"><span>=# End:=
</span></span></code></pre></div><div class="src-block-caption">
  <span class="src-block-number">Code Snippet 1:</span>
  example for local variable setup
</div>
<p>å½“ç„¶ï¼Œè¿˜å¾—åŠ ä¸Šå¯¼å‡ºæ–‡ä»¶çš„è®¾ç½®ï¼Œæ¯”å¦‚ï¼š</p>
<blockquote>
<p><code>#+export_file_name: /you/export/file/path</code></p>
</blockquote>
<p>OK, æ‰“å®Œï¼Œæ”¶åŠŸï¼</p>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">Last modified on 2024-11-01</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="/posts/doomemacs-gui-%E4%B8%AD%E6%96%87%E6%98%BE%E7%A4%BA%E8%AE%BE%E7%BD%AE/">
			Next<br>doomemacs GUI ä¸­æ–‡æ˜¾ç¤ºåŠè¾“å…¥æ³•è®¾ç½®
                </a>
                
                
                
                <a class="older-posts" href="/posts/%E8%B0%88%E8%B0%88%E4%B8%AD%E6%96%87%E6%8A%80%E6%9C%AF%E5%90%8D%E8%AF%8D%E7%9A%84%E7%BF%BB%E8%AF%91%E4%B9%8B-ssh-%E7%88%86%E7%A0%B4/">
			Previous<br>è°ˆè°ˆä¸­æ–‡æŠ€æœ¯åè¯çš„ç¿»è¯‘
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                












            </div>
        </div>
    </div>


                    </div>
            </div><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="http://localhost:1313/">
    
        <div class="nav-title">
            A Byte of Cybersecurity
        </div>
        
        <div class="nav-subtitle">
            ğŸ’“ â˜®ï¸
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories/">
                categories
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags/">
                tags
            </a>
            
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/posts/">
                posts
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	2025 A Byte of Cybersecurity
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    <div class="toc-wrapper">
        

        
        <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#trial-1-after-save-hook" class="nav-trial-1-after-save-hook">
									Trial 1 - after-save-hook
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#trial-2-before-save-hook" class="nav-trial-2-before-save-hook">
									Trial 2 - before-save-hook
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#tiral-3-before-save-hook-localization" class="nav-tiral-3-before-save-hook-localization">
									Tiral 3 - before-save-hook localization
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%9b%b4%e5%a4%9a%e8%ae%be%e7%bd%ae" class="nav-æ›´å¤šè®¾ç½®">
									æ›´å¤šè®¾ç½®
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
        
    </div>
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top"
            :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>

<div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	2025 A Byte of Cybersecurity
	
</div>
            </div>
    
    <script src="/js/journal.js"></script></body>
</html>
